<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>MyNote - ë‚˜ì˜ ë©”ëª¨</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-5">
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>ğŸ““ ë‚˜ì˜ ë¹„ë°€ ë©”ëª¨ì¥</h2>
    <button class="btn btn-outline-danger" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
</div>

<div class="card mb-4 shadow-sm">
    <div class="card-body">
        <h5 class="card-title">ìƒˆ ë©”ëª¨ ì‘ì„±</h5>
        <input type="text" id="title" class="form-control mb-2" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
        <textarea id="content" class="form-control mb-2" rows="3" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
        <button class="btn btn-primary w-100" onclick="createMemo()">ë©”ëª¨ ì €ì¥í•˜ê¸°</button>
    </div>
</div>

<hr>

<div id="memo-list" class="row"></div>

<script>
    const token = localStorage.getItem('token'); // ë¡œê·¸ì¸ ì‹œ ì €ì¥í•œ í† í°

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰: ë©”ëª¨ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    window.onload = async function() {
        if (!token) {
            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤!');
            location.href = '/login';
            return;
        }
        loadMemos();
    };

    // [ëª©ë¡ ì¡°íšŒ] GET /memos
    async function loadMemos() {
        const response = await fetch('/memos', {
            method: 'GET',
            headers: { 'Authorization': 'Bearer ' + token }
        });
        const result = await response.json();

        if (result.success) {
            const memoList = document.getElementById('memo-list');
            memoList.innerHTML = ''; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”
            result.data.forEach(memo => {
                const card = `
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">${memo.title}</h5>
                                <p class="card-text">${memo.content}</p>
                                <button class="btn btn-sm btn-danger" onclick="deleteMemo(${memo.id})">ì‚­ì œ</button>
                            </div>
                        </div>
                    </div>`;
                memoList.innerHTML += card;
            });
        }
    }

    // [ë©”ëª¨ ì €ì¥] POST /memos
    async function createMemo() {
        const title = document.getElementById('title').value;
        const content = document.getElementById('content').value;

        const response = await fetch('/memos', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            body: JSON.stringify({ title, content })
        });

        const result = await response.json();
        if (result.success) {
            document.getElementById('title').value = '';
            document.getElementById('content').value = '';
            loadMemos(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        } else {
            alert('ì €ì¥ ì‹¤íŒ¨: ' + result.error.message);
        }
    }

    // [ë©”ëª¨ ì‚­ì œ] DELETE /memos/{id}
    async function deleteMemo(id) {
        if (!confirm('ì´ ë©”ëª¨ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

        const response = await fetch('/memos/' + id, {
            method: 'DELETE',
            headers: { 'Authorization': 'Bearer ' + token }
        });

        const result = await response.json();
        if (result.success) {
            loadMemos();
        } else {
            alert('ì‚­ì œ ì‹¤íŒ¨: ' + result.error.message);
        }
    }

    function logout() {
        localStorage.removeItem('token');
        location.href = '/login';
    }
</script>
</body>
</html>