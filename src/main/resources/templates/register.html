<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>MyNote - 회원가입</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="d-flex align-items-center py-4 bg-light" style="height: 100vh;">
<main class="form-signin w-100 m-auto" style="max-width: 330px;">
    <h1 class="h3 mb-3 fw-normal text-center">회원가입</h1>
    <div class="form-floating mb-2">
        <input type="text" class="form-control" id="username" placeholder="아이디">
        <label for="username">아이디</label>
    </div>
    <div class="form-floating mb-3">
        <input type="password" class="form-control" id="password" placeholder="비밀번호">
        <label for="password">비밀번호</label>
    </div>
    <button class="w-100 btn btn-lg btn-success" onclick="register()">가입하기</button>
    <p class="mt-3 text-center"><a href="/login">로그인하러 가기</a></p>
</main>

<script>
    async function register() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        if (!username || !password) {
            alert("아이디와 비밀번호를 모두 입력해주세요.");
            return;
        }

        const response = await fetch('/auth/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        });

        // 서버가 에러(RuntimeException)를 던져도 JSON 응답은 옵니다.
        const result = await response.json();

    if (result.success) {
        alert('회원가입 성공!');
        location.href = '/login';
    } else {
        // result.error가 객체이므로, 그 안의 message 필드를 출력해야 합니다.
        // 만약 ApiError 클래스에 필드명이 message라면 result.error.message입니다.
        alert('가입 실패: ' + (result.error.message || result.error));
    }
    }
</script>
</body>
</html>